# Tezos ERC-1155 smart contract specification

## Abstract

This document describes specification for Tezos ERC-1155 contract adapted from the
corresponding specification for [Ethereum](https://eips.ethereum.org/EIPS/eip-1155).
Token standards like ERC-20 and ERC-721 require a separate contract to be deployed for each
token type or collection. ERC-1155 contract manages multiple token types. A new token can be
created and configured without redeploying the contract. Both fungible and non-fungible tokens
can be stored in the same smart-contract.

## ERC-1155 overview

**Token type** is a specific token represented by its ID. **Owner** - Tezos address which can
hold tokens. **Operator** - Tezos address which initiates token transfer operation. **Operator**
must be approved to manage all tokens hold by the owner to make a transfer from the owner account.

Destination address for token transfer operation MUST implement `ERC1155TokenReceiver` interface,
which MUST be called for transfer/mint transactions. Destination address may reject receiving
tokens by generating failure. This is considered a safety feature ("safe transfer") to prevent
unrecoverable tokens if sent to an address that does not expect to receive ERC-1155 tokens.

ERC-1155 supports both single token transfer and atomic batch transfer of multiple tokens.

Administrative operations to create new token types, mint and burn tokens are not part of ERC-1155
specification.

## Difference between Ethereum and Tezos

Since Tezos and Michelson differ from Ethereum/Solidity, the following modifications are made:

1. Tezos ERC-1155 does not emit events (a feature not supported by Tezos).
2. Tezos ERC-1155 does not implement ERC-165 `supportsInterface` entry point.
3. Ethereum specification says that if destination transfer address is not a smart contract (EOA),
then safety check is not performed. It is not entirely clear what is Ethereum motivation here...
Tezos does not have such a distinction between Externally Owned Accounts and Contract Accounts (all
Tezos accounts since Babylon have smart contracts). Tezos specification requires that any destination
contract MUST implement `ERC1155TokenReceiver` interface, so the standard supports safe-style transfers
only.
4. Optional `ERC1155Metadata_URI` interface is not part of Tezos ERC-1155 specification.

## Specification

Specification is given as definition of Michelson entry points defined in [cameligo language](https://ligolang.org).
ERC-1155 specification consist of two interfaces: `erc1155` and `erc1155_token_receiver`.

** Smart contracts implementing the ERC-1155 standard protocol MUST implement all of the entry points
in the `erc1155` interface.**

** All smart contracts which can be a target destination for the token transfers MUST implement all of the
entry points in the `erc1155_token_receiver` interface.

### `erc1155` entry points

```ocaml
type token_id = nat

type safe_transfer_from_param = {
  from: address;      (* Source address *)
  to_:   address;     (* Target address. Target smart contract must implement entry points from `erc1155_receiver` interface *)
  token_id: token_id; (* ID of the token type *)
  amount: nat;        (* Transfer amount *)
  data: bytes;        (* Additional data with no specified format, MUST be sent unaltered in call to `OnERC1155Received` on `to_` *)
}

type tx = {
  token_id: token_id; (* ID of the token type *)
  amount: nat;        (* Transfer amount *)
}

type safe_batch_transfer_from_param = {
  from: address;      (* Source address *)
  to_:   address;     (* Target address. Target smart contract must implement entry points from `erc1155_receiver` interface *)
  batch: tx list;     (* Batch of tokens and their amounts to be transferred *)
  data: bytes;        (* Additional data with no specified format, MUST be sent unaltered in call to `OnERC1155BatchReceived` on `to_` *)
}

type balance_request = {
  owner: address;
  token_id: token_id;
}

type balance_of_param = {
  balance_request: balance_request;
  balance_view: balance_request * nat -> operation;
}

type balance_of_batch_param = {
  balance_request: balance_request list;
  balance_view: balance_request * nat list -> operation;
}

type set_approval_for_all_param = {
  operator: address;
  approved: bool;
}

type is_approved_for_all = {
  owner: address;
  operator: address;
  approved_view: address*address*bool -> operation
}

(* ERC1155 entry points *)
type erc1155 =
  | SafeTransferFrom of safe_transfer_from_param
  | SafeBatchTransferFrom of safe_batch_transfer_from_param
  | BalanceOf of balance_of_param
  | BalanceOfBatch of balance_of_batch_param
  | SetApprovalForAll of set_approval_for_all_param
  | IsApprovedForAll of is_approved_for_all
  | Default of unit
```

#### `SafeTransferFrom` Rules

Transfers specified `amount` of `token_id` from `from` address to `to_` address.

Sender MUST be approved to manage the tokens being transferred out of the `from` account or be the same address as `from`
address (see "Approval" section of the standard). Otherwise the transaction should fail.

The transaction MUST fail if balance of holder for token `token_id` is lower than the `amount` sent. If
holder does not hold any tokens of type `token_id`, holder's balance is interpreted as zero.

The transaction MUST call entry point `OnERC1155Received` or `OnERC1155TokenReceived` of contract `to_` and MUST return
call `operation` among other operations it might create. If `to_` contract does not implement entry point `OnERC1155Received`,
the transaction MUST fail. `data` argument must be passed unaltered to a receiver hook entry point. A contract MAY skip calling
the `OnERC1155Received` hook function if the transfer operation is transferring the token to itself.

##### `SafeBatchTransferFrom` Rules

Transfers specified amounts between addresses specified in the batch. Transfers should happen atomically: if at least one
specified transfer cannot be completed, the whole transaction MUST fail.

Sender MUST be approved to manage the tokens being transferred out of the `from` account or be the same address as `from`
address (see "Approval" section of the standard). Otherwise the transaction should fail.

The transaction MUST fail if any of the balance(s) of the holder for token(s) in the batch is lower than the respective
amount(s) sent. If holder does not hold any tokens of type `token_id`, holder's balance is interpreted as zero.

Balance transfers MUST occur in order they are specified in the batch.

The transaction MUST call entry point `OnERC1155TokenReceived` or `OnERC1155Received` of contract `to_` and MUST return
call `operation` among other operations it might create. If `to_` contract does not implement entry point `OnERC1155Received`,
the transaction MUST fail. `data` argument must be passed unaltered to a receiver hook entry point.
`OnERC1155TokenReceived` and `OnERC1155Received` MAY be called multiple times from the transaction in any combination and
the following requirements must be met:

* All calls must represent mutually exclusive balance changes.
* The set of all calls to `OnERC1155Received` and `OnERC1155BatchReceived` describes all balance changes that occurred during
the transaction in the order submitted.
* A contract MAY skip calling the `OnERC1155Received` hook function if the transfer operation is transferring the token to itself.

### Approval

### Minting/creating and burning/destroying rules
