# Tezos ERC-1155 smart contract specification

## Abstract

This document describes specification for Tezos ERC-1155 contract adapted from the
corresponding specification for [Ethereum](https://eips.ethereum.org/EIPS/eip-1155).
Token standards like ERC-20 and ERC-721 require a separate contract to be deployed for each
token type or collection. ERC-1155 contract manages multiple token types. A new token can be
created and configured without redeploying the contract. Both fungible and non-fungible tokens
can be stored in the same smart-contract.

## ERC-1155 overview

**Token type** is a specific token represented by its ID. **Owner** - Tezos address which can
hold tokens. **Operator** - Tezos address which initiates token transfer operation. **Operator**
must be approved to manage all tokens hold by the owner to make a transfer from the owner account.

Destination address for token transfer operation MUST implement `ERC1155TokenReceiver` interface,
which MUST be called for transfer/mint transactions. Destination address may reject receiving
tokens by generating failure. This is considered a safety feature ("safe transfer").

ERC-1155 supports both single token transfer and atomic batch transfer of multiple tokens.

Administrative operations to create new token types, mint and burn tokens are not part of ERC-1155
specification.

## Difference between Ethereum and Tezos

Since Tezos and Michelson differ from Ethereum/Solidity, the following modifications are made:

1. Tezos ERC-1155 does not emit events (a feature not supported by Tezos).
2. Tezos ERC-1155 does not implement ERC-165 `supportsInterface` entry point.
3. Ethereum specification says that if destination transfer address is not a smart contract (EOA),
then safety check is not performed. It is not entirely clear what is Ethereum motivation here...
Tezos does not have such a distinction between Externally Owned Accounts and Contract Accounts (all
Tezos accounts since Babylon have smart contracts). Tezos specification requires that any destination
contract MUST implement `ERC1155TokenReceiver` interface, so the standard supports safe-style transfers
only.
4. Optional `ERC1155Metadata_URI` interface is not part of Tezos ERC-1155 specification.

## Specification

Specification is given as definition of Michelson entry points defined in [cameligo language](https://ligolang.org).
ERC-1155 specification consist of two interfaces: `erc1155` and `erc1155_receiver`.

** Smart contracts implementing the ERC-1155 standard protocol MUST implement all of the entry points
in the `erc1155` interface.**

** All smart contracts which can be a target destination for the token transfers MUST implement all of the
entry points in the `erc1155_receiver` interface.

### `tx` transfer definition type

```ocaml
type token_id = nat

type tx = {
  from: address;      (* source address *)
  to_:   address;     (* target address. Target smart contract must implement entry points from `erc1155_receiver` interface *)
  token_id: token_id; (* ID of the token type *)
  amount: nat;        (* transfer amount *)
}
```

### `erc1155` entry points

```ocaml
type safe_transfer_from_param = {
  tx: tx;       (* transfer definition *)
  data: bytes;  (* Additional data with no specified format, MUST be sent unaltered in call to `OnERC1155Received` on `to_` *)
}

type safe_batch_transfer_from_param = {
  txs: tx list; (* batch of transaction definitions *)
  data: bytes;  (* Additional data with no specified format, MUST be sent unaltered in call to `OnERC1155BatchReceived` on `to_` *)
}

type balance_request = {
  owner: address;
  token_id: token_id;
}

type balance_of_param = {
  balance_request: balance_request;
  balance_view: balance_request * nat -> operation;
}

type balance_of_batch_param = {
  balance_request: balance_request list;
  balance_view: balance_request * nat list -> operation;
}

type set_approval_for_all_param = {
  operator: address;
  approved: bool;
}

type is_approved_for_all = {
  owner: address;
  operator: address;
  approved_view: address*address*bool -> operation
}

(* ERC1155 entry points *)
type erc1155 =
  | SafeTransferFrom of safe_transfer_from_param
  | SafeBatchTransferFrom of safe_batch_transfer_from_param
  | BalanceOf of balance_of_param
  | BalanceOfBatch of balance_of_batch_param
  | SetApprovalForAll of set_approval_for_all_param
  | IsApprovedForAll of is_approved_for_all
  | Default of unit
```

#### `SafeTransferFrom` Rules

Transfers specified `tx.amount` of `tx.token_id` from `tx.from` address to `tx.to_` address.

Sender MUST be approved to manage the tokens being transferred out of the `tx._from` account or be the same address as `tx.from`
address (see "Approval" section of the standard). Otherwise the transaction should fail.

The transaction MUST fail if balance of holder for token `tx.token_id` is lower than the `tx.amount` sent. If
holder does not hold any tokens of type `tx.token_id`, holder's balance is interpreted as zero.

The transaction MUST call entry point `OnERC1155Received` of contract `tx.to` and MUST return call `operation` among
other operations it might create. If `tx.to` contract does not implement entry point `OnERC1155Received`, the transaction
MUST fail. See also "Safe Transfer Rules" section of the standard.

##### `SafeBatchTransferFrom` Rules

Transfers specified amounts between addresses specified in the batch. Transfers should happen atomically: if at least one
specified transfer cannot be completed

### Safe Transfer Rules



### Approval
